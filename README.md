# Go-BBDown

ğŸš€ **é«˜æ€§èƒ½å“”å“©å“”å“©è§†é¢‘ä¸‹è½½å™¨ - Goè¯­è¨€å®ç°**

åŸºäºåŸC#ç‰ˆæœ¬BBDownçš„å®Œæ•´Goè¯­è¨€é‡å†™ï¼Œæä¾›æ›´å¿«çš„é€Ÿåº¦ã€æ›´å°çš„å†…å­˜å ç”¨å’Œæ›´å¥½çš„è·¨å¹³å°ä½“éªŒã€‚

![Go Version](https://img.shields.io/badge/Go-1.21+-blue)
![License](https://img.shields.io/badge/License-MIT-green)
![Platform](https://img.shields.io/badge/Platform-Windows%20%7C%20macOS%20%7C%20Linux-lightgrey)

> æœ¬é¡¹ç›®ä»…ä¾›ä¸ªäººå­¦ä¹ ã€ç ”ç©¶å’Œéå•†ä¸šæ€§ç”¨é€”ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨æœ¬å·¥å…·æ—¶ï¼Œéœ€è‡ªè¡Œç¡®ä¿éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ï¼Œç‰¹åˆ«æ˜¯ä¸ç‰ˆæƒç›¸å…³çš„æ³•å¾‹æ¡æ¬¾ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ” å®Œæ•´çš„è®¤è¯ç³»ç»Ÿ
- **WBIç­¾åç®—æ³•**: å®Œæ•´å®ç°å“”å“©å“”å“©æœ€æ–°WBIè®¤è¯æœºåˆ¶
- **å¤šAPIæ”¯æŒ**: Webç«¯ã€TVç«¯ã€APPç«¯ã€å›½é™…ç‰ˆAPI
- **æ™ºèƒ½åˆ‡æ¢**: è‡ªåŠ¨é€‰æ‹©æœ€ä½³APIæ¥å£è·å–é«˜è´¨é‡èµ„æº
- **Cookieç®¡ç†**: æ”¯æŒç½‘é¡µç«¯å’ŒTVç«¯Cookieè®¤è¯

### âš¡ é«˜æ€§èƒ½ä¸‹è½½å¼•æ“
- **å¤šçº¿ç¨‹å¹¶å‘**: Goroutineå¹¶å‘ä¸‹è½½ï¼Œæœ€å¤§åŒ–å¸¦å®½åˆ©ç”¨
- **æ™ºèƒ½åˆ†å—**: è‡ªåŠ¨è®¡ç®—æœ€ä¼˜åˆ†å—å¤§å°
- **æ–­ç‚¹ç»­ä¼ **: æ”¯æŒä¸‹è½½ä¸­æ–­åç»§ç»­
- **è¿›åº¦ç›‘æ§**: å®æ—¶æ˜¾ç¤ºä¸‹è½½è¿›åº¦å’Œé€Ÿåº¦

### ğŸµ æ™ºèƒ½éŸ³è§†é¢‘å¤„ç†
- **æ ¼å¼æ”¯æŒ**: M4Aã€MP3ã€AACã€Opusã€FLACç­‰éŸ³é¢‘æ ¼å¼
- **è‡ªåŠ¨æ£€æµ‹**: æ™ºèƒ½è¯†åˆ«éŸ³é¢‘ç¼–ç æ ¼å¼
- **FFmpegé›†æˆ**: æ— ç¼éŸ³è§†é¢‘æ··æµå¤„ç†
- **å•ç‹¬ä¿å­˜**: éŸ³é¢‘æ–‡ä»¶è‡ªåŠ¨å•ç‹¬ä¿å­˜

### ğŸ“ é«˜çº§æ–‡ä»¶ç®¡ç†
- **æ™ºèƒ½å‘½å**: partä¸ºç©ºæ—¶ä½¿ç”¨æ ‡é¢˜ï¼Œå¦åˆ™ä½¿ç”¨part
- **å¤šåˆ†På¤„ç†**: è‡ªåŠ¨æ·»åŠ _P1ã€_P2åç¼€é¿å…é‡å¤
- **è·¨å¹³å°**: ç»Ÿä¸€çš„æ–‡ä»¶åå¤„ç†å’Œè·¯å¾„ç®¡ç†
- **æ¨¡æ¿æ”¯æŒ**: è‡ªå®šä¹‰æ–‡ä»¶åæ¨¡æ¿

### ğŸŒ å…¨å¹³å°å…¼å®¹
- **å•æ–‡ä»¶éƒ¨ç½²**: ç¼–è¯‘åå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶
- **è·¨å¹³å°**: Windowsã€macOSã€Linuxå…¨æ”¯æŒ
- **ä½èµ„æº**: æä½çš„å†…å­˜å ç”¨å’ŒCPUä½¿ç”¨
- **å®¹å™¨åŒ–**: æä¾›Dockeréƒ¨ç½²æ–¹æ¡ˆ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæ¨¡å—è®¾è®¡

```
go-bbdown/
â”œâ”€â”€ main.go                 # ç¨‹åºå…¥å£ç‚¹
â”œâ”€â”€ cmd/                    # å‘½ä»¤è¡Œæ¥å£
â”‚   â””â”€â”€ root.go            # Cobraå‘½ä»¤è¡Œæ¡†æ¶
â”œâ”€â”€ core/                  # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ config.go         # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ download.go       # ä¸‹è½½å¼•æ“
â”‚   â”œâ”€â”€ entities.go       # æ•°æ®ç»“æ„å®šä¹‰
â”‚   â”œâ”€â”€ http.go          # HTTPå®¢æˆ·ç«¯
â”‚   â””â”€â”€ parser.go        # æ•°æ®è§£æå™¨
â””â”€â”€ util/                 # å·¥å…·åº“
    â”œâ”€â”€ file.go          # æ–‡ä»¶æ“ä½œå·¥å…·
    â””â”€â”€ string.go        # å­—ç¬¦ä¸²å¤„ç†å·¥å…·
```

### æ ¸å¿ƒç®—æ³•å®ç°

#### WBIç­¾åç®—æ³•
```go
// åŠ¨æ€è·å–WBIå¯†é’¥å¹¶ç”Ÿæˆç­¾å
func GenerateWBISign(params map[string]string) string {
    mixKey := getMixKey()
    // æŒ‰å“”å“©å“”å“©è§„åˆ™ç”Ÿæˆç­¾å
    return wbiSignature
}
```

#### BVè½¬æ¢ç®—æ³•
```go
// é«˜æ•ˆçš„BVå·ä¸AVå·åŒå‘è½¬æ¢
func BvToAv(bvid string) (int64, error) {
    // XORå˜æ¢å’Œè¡¨æ˜ å°„ç®—æ³•
    return aid, nil
}
```

#### å¤šçº¿ç¨‹ä¸‹è½½
```go
// Goroutineå¹¶å‘ä¸‹è½½å®ç°
func multiThreadDownload(url, filename string, threads int) error {
    // æ™ºèƒ½åˆ†å—å’Œå¹¶å‘ç®¡ç†
    return downloadWithProgress()
}
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…æ–¹å¼

#### ä»æºç ç¼–è¯‘
```bash
git clone https://github.com/tekintian/go-bbdown.git
cd go-bbdown
go mod tidy
go build -o bbdown main.go
```

#### é¢„ç¼–è¯‘ä¸‹è½½ï¼ˆæ¨èï¼‰
```bash
# ä¸‹è½½å¯¹åº”å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶
wget https://github.com/tekintian/go-bbdown/releases/latest/download/bbdown-linux-amd64
chmod +x bbdown-linux-amd64
```

### åŸºæœ¬ä½¿ç”¨

```bash
# ä¸‹è½½æ™®é€šè§†é¢‘
./bbdown https://www.bilibili.com/video/BV1xxxxxx

# ä½¿ç”¨TVæ¥å£ï¼ˆé«˜è´¨é‡æ— æ°´å°ï¼‰
./bbdown -tv https://www.bilibili.com/video/BV1xxxxxx

# å¤šçº¿ç¨‹ä¸‹è½½
./bbdown -mt https://www.bilibili.com/video/BV1xxxxxx

# äº¤äº’å¼é€‰æ‹©æ¸…æ™°åº¦
./bbdown -ia https://www.bilibili.com/video/BV1xxxxxx
```

## ğŸ“‹ å‘½ä»¤è¡Œå‚æ•°è¯¦è§£

### APIæ¨¡å¼é€‰æ‹©
- `-tv, --use-tv-api` - ä½¿ç”¨TVç«¯APIï¼ˆé«˜è´¨é‡æ— æ°´å°ï¼‰
- `-app, --use-app-api` - ä½¿ç”¨APPç«¯API
- `-intl, --use-intl-api` - ä½¿ç”¨å›½é™…ç‰ˆAPIï¼ˆä¸œå—äºšè§†é¢‘ï¼‰

### ä¸‹è½½æ§åˆ¶
- `-mt, --multi-thread` - å¯ç”¨å¤šçº¿ç¨‹ä¸‹è½½ï¼ˆé»˜è®¤å¼€å¯ï¼‰
- `-ia, --interactive` - äº¤äº’å¼é€‰æ‹©æ¸…æ™°åº¦
- `--video-only` - ä»…ä¸‹è½½è§†é¢‘æµ
- `--audio-only` - ä»…ä¸‹è½½éŸ³é¢‘æµ
- `--skip-mux` - è·³è¿‡éŸ³è§†é¢‘æ··æµ

### è´¨é‡é€‰æ‹©
- `-e, --encoding-priority` - è§†é¢‘ç¼–ç ä¼˜å…ˆçº§ï¼š"hevc,av1,avc"
- `-q, --dfn-priority` - ç”»è´¨ä¼˜å…ˆçº§ï¼š"8K è¶…é«˜æ¸…, 4K è¶…æ¸…, 1080P é«˜ç ç‡"

### æ–‡ä»¶ç®¡ç†
- `-F, --file-pattern` - å•æ–‡ä»¶å‘½åæ¨¡æ¿
- `-M, --multi-file-pattern` - å¤šæ–‡ä»¶å‘½åæ¨¡æ¿
- `-p, --select-page` - é€‰æ‹©æŒ‡å®šåˆ†Pï¼š"1,3-5" æˆ– "ALL"

### ç½‘ç»œè®¾ç½®
- `-c, --cookie` - ç½‘é¡µç«¯Cookie
- `-token, --access-token` - TV/APPç«¯è®¿é—®ä»¤ç‰Œ
- `--ffmpeg-path` - FFmpegå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
- `--work-dir` - è®¾ç½®å·¥ä½œç›®å½•

## ğŸ¯ é«˜çº§ä½¿ç”¨åœºæ™¯

### æ™ºèƒ½æ–‡ä»¶å‘½å
```bash
# è‡ªå®šä¹‰å•æ–‡ä»¶å‘½å
./bbdown -F "<videoTitle>_<dfn>" https://www.bilibili.com/video/BV1xxxxxx

# å¤šåˆ†Pæ–‡ä»¶ç»„ç»‡
./bbdown -M "<videoTitle>/P<pageNumberWithZero>_<pageTitle>" https://www.bilibili.com/video/BV1xxxxxx
```

### è®¤è¯é…ç½®
```bash
# ä½¿ç”¨ç½‘é¡µCookieä¸‹è½½ä¼šå‘˜å†…å®¹
./bbdown -c "SESSDATA=xxx; bili_jct=xxx" https://www.bilibili.com/video/BV1xxxxxx

# ä½¿ç”¨TVç«¯Token
./bbdown -tv -token "access_token=xxx" https://www.bilibili.com/video/BV1xxxxxx

# ä½¿ç”¨APPç«¯Token
./bbdown -app -token "access_token=xxx" https://www.bilibili.com/video/BV1xxxxxx
```

### åˆ†Pä¸‹è½½æ§åˆ¶
```bash
# ä¸‹è½½æŒ‡å®šåˆ†P
./bbdown -p 1,3,5 https://www.bilibili.com/video/BV1xxxxxx

# ä¸‹è½½èŒƒå›´åˆ†P
./bbdown -p 1-10 https://www.bilibili.com/video/BV1xxxxxx

# ä¸‹è½½æ‰€æœ‰åˆ†P
./bbdown -p ALL https://www.bilibili.com/video/BV1xxxxxx
```

### ä»…éŸ³é¢‘ä¸‹è½½
```bash
# ä¸‹è½½é«˜è´¨é‡éŸ³é¢‘
./bbdown --audio-only -q "320kbps" https://www.bilibili.com/video/BV1xxxxxx

# è‡ªåŠ¨ä¿å­˜éŸ³é¢‘æ–‡ä»¶ï¼ˆæ ¼å¼æ£€æµ‹ï¼‰
./bbdown https://www.bilibili.com/video/BV1xxxxxx
# ä¼šåŒæ—¶ä¿å­˜ï¼švideo.mp4 å’Œ audio.m4a
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| ç‰¹æ€§ | C#ç‰ˆæœ¬ | Goç‰ˆæœ¬ |
|------|--------|--------|
| å¯åŠ¨é€Ÿåº¦ | æ…¢ï¼ˆ.NETå¯åŠ¨ï¼‰ | å¿« |
| å†…å­˜å ç”¨ | é«˜ï¼ˆ~100MBï¼‰ | ä½ï¼ˆ~20MBï¼‰ |
| CPUä½¿ç”¨ | ä¸­ç­‰ | ä½ |
| å¹¶å‘æ€§èƒ½ | ä¸­ç­‰ | ä¼˜ç§€ |
| æ–‡ä»¶å¤§å° | å¤§ï¼ˆ~50MBï¼‰ | å°ï¼ˆ~15MBï¼‰ |
| éƒ¨ç½²æ–¹å¼ | ä¾èµ–.NETè¿è¡Œæ—¶ | å•æ–‡ä»¶éƒ¨ç½² |
| è·¨å¹³å° | è‰¯å¥½ | ä¼˜ç§€ |

## ğŸ”§ å¤–éƒ¨ä¾èµ–

### å¿…éœ€ä¾èµ–
- **FFmpeg**: éŸ³è§†é¢‘æ··æµï¼ˆæ¨è5.0+ï¼‰
  - Windows: ä¸‹è½½åˆ° `C:\ffmpeg\bin\ffmpeg.exe`
  - macOS: `brew install ffmpeg`
  - Linux: `sudo apt install ffmpeg`

### å¯é€‰ä¾èµ–
- **aria2c**: å¤šçº¿ç¨‹ä¸‹è½½åŠ é€Ÿå™¨
  - Windows: ä¸‹è½½å¹¶æ·»åŠ åˆ°PATH
  - macOS: `brew install aria2`
  - Linux: `sudo apt install aria2c`

### ä¾èµ–æ£€æµ‹
ç¨‹åºå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹ä¾èµ–ï¼š
```bash
./bbdown
[INFO] FFmpeg found: /usr/local/bin/ffmpeg
[INFO] aria2c found: /usr/local/bin/aria2c
[INFO] All dependencies ready
```

## ğŸ“ é…ç½®æ–‡ä»¶

æ”¯æŒYAMLé…ç½®æ–‡ä»¶ï¼Œä½ç½®ï¼š`~/.bbdown.yaml`

```yaml
# APIè®¾ç½®
api:
  use-tv: false
  use-app: false
  use-intl: false

# ä¸‹è½½è®¾ç½®
download:
  multi-thread: true
  encoding-priority: ["hevc", "av1", "avc"]
  dfn-priority: ["8K è¶…é«˜æ¸…", "4K è¶…æ¸…", "1080P é«˜ç ç‡"]

# æ–‡ä»¶è®¾ç½®
files:
  file-pattern: "<videoTitle>"
  multi-file-pattern: "<videoTitle>/[P<pageNumberWithZero>]<pageTitle>"
  work-dir: "./downloads"

# å¤–éƒ¨å·¥å…·
tools:
  ffmpeg-path: "/usr/local/bin/ffmpeg"
  aria2c-path: "/usr/local/bin/aria2c"

# ç½‘ç»œè®¾ç½®
network:
  user-agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
  cookie: ""
  access-token: ""
```

## ğŸ³ Dockeréƒ¨ç½²

```dockerfile
FROM alpine:latest
RUN apk add --no-cache ffmpeg aria2
COPY bbdown /usr/local/bin/
ENTRYPOINT ["bbdown"]
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
docker build -t bbdown .
docker run -v $(pwd)/downloads:/downloads bbdown https://www.bilibili.com/video/BV1xxxxxx
```

## ğŸ® å®é™…åº”ç”¨ç¤ºä¾‹

### 1. æ‰¹é‡ä¸‹è½½ç³»åˆ—è§†é¢‘
```bash
# åˆ›å»ºè„šæœ¬
for url in $(cat video_list.txt); do
    ./bbdown -tv -mt "$url"
done
```

### 2. é«˜è´¨é‡éŸ³é¢‘æå–
```bash
# æå–æ— æŸéŸ³é¢‘
./bbdown --audio-only -q "æ— æŸ" https://www.bilibili.com/video/BV1xxxxxx
```

### 3. è‡ªåŠ¨åŒ–å·¥ä½œæµ
```bash
#!/bin/bash
# ä¸‹è½½åè‡ªåŠ¨ä¸Šä¼ åˆ°äº‘å­˜å‚¨
URL="https://www.bilibili.com/video/BV1xxxxxx"
./bbdown -tv "$URL"
find . -name "*.mp4" -exec rclone copy {} cloud:videos/ \;
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æç¤º"FFmpeg not found"**
```bash
# è§£å†³æ–¹æ¡ˆ1ï¼šæŒ‡å®šè·¯å¾„
./bbdown --ffmpeg-path /path/to/ffmpeg https://...

# è§£å†³æ–¹æ¡ˆ2ï¼šæ·»åŠ åˆ°PATH
export PATH=$PATH:/path/to/ffmpeg/dir
```

**Q: ä¸‹è½½é€Ÿåº¦æ…¢**
```bash
# ä½¿ç”¨TVç«¯APIï¼ˆé€šå¸¸æ›´å¿«ï¼‰
./bbdown -tv -mt https://...

# æˆ–ä½¿ç”¨aria2cåŠ é€Ÿ
./bbdown --use-aria2c https://...
```

**Q: æ— æ³•ä¸‹è½½ä¼šå‘˜å†…å®¹**
```bash
# æ£€æŸ¥Cookieæ˜¯å¦æœ‰æ•ˆ
./bbdown -c "SESSDATA=xxx" --info https://...
# ç¡®è®¤èƒ½çœ‹åˆ°ä¼šå‘˜æ¸…æ™°åº¦åå†ä¸‹è½½
```

### è°ƒè¯•æ¨¡å¼
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
./bbdown --debug https://www.bilibili.com/video/BV1xxxxxx

# ä»…æŸ¥çœ‹ä¿¡æ¯ï¼Œä¸ä¸‹è½½
./bbdown --info https://www.bilibili.com/video/BV1xxxxxx
```

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°

```bash
# æ£€æŸ¥å½“å‰ç‰ˆæœ¬
./bbdown --version

# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
go install github.com/tekintian/go-bbdown/go_bbdown@latest
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add amazing feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/amazing-feature`
5. æäº¤Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºMITè®¸å¯è¯å¼€æºã€‚è¯¦è§[LICENSE](../LICENSE)æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

- åŸC#ç‰ˆæœ¬BBDownï¼š[nilaoda/BBDown](https://github.com/nilaoda/BBDown)
- å“”å“©å“”å“©APIæ”¶é›†ï¼š[SocialSisterYi/bilibili-API-collect](https://github.com/SocialSisterYi/bilibili-API-collect)
- Cobraæ¡†æ¶ï¼š[spf13/cobra](https://github.com/spf13/cobra)

---

**Go-BBDown**: ä¸ºè¿½æ±‚æè‡´æ€§èƒ½è€Œç”Ÿçš„å“”å“©å“”å“©ä¸‹è½½å™¨ ğŸš€